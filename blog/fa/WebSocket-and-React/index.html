<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.0.9"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://sirwanafifi.github.io/blog/fa/WebSocket-and-React/"><!-- Primary Meta Tags --><title>WebSocket and React</title><meta name="title" content="WebSocket and React"><meta name="description" content="WebSocket is a communication protocol. It's bidirectional in nature which means that either client or server can send data at any time. With WebSocket, we can build applications such as multiplayer games, ..."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://sirwanafifi.github.io/blog/fa/WebSocket-and-React/"><meta property="og:title" content="WebSocket and React"><meta property="og:description" content="WebSocket is a communication protocol. It's bidirectional in nature which means that either client or server can send data at any time. With WebSocket, we can build applications such as multiplayer games, ..."><meta property="og:image" content="https://sirwanafifi.github.io/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://sirwanafifi.github.io/blog/fa/WebSocket-and-React/"><meta property="twitter:title" content="WebSocket and React"><meta property="twitter:description" content="WebSocket is a communication protocol. It's bidirectional in nature which means that either client or server can send data at any time. With WebSocket, we can build applications such as multiplayer games, ..."><meta property="twitter:image" content="https://sirwanafifi.github.io/blog-placeholder-1.jpg"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/about.lZdPILSY.css" />
<link rel="stylesheet" href="/_astro/about.MT11H7wM.css" />
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}
footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
</style><script type="module" src="/_astro/hoisted.4PK_pqbL.js"></script></head> <body class="bg-white antialiased dark:bg-zinc-900"> <header class="mb-30"> <nav class="w-full z-20 top-0 start-0 border-b border-gray-200 text-white dark:text-emerald-400"> <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"> <a href="/" class="flex items-center space-x-3 rtl:space-x-reverse"></a> <div class="flex md:order-2 space-x-3 md:space-x-0 rtl:space-x-reverse"></div> <div class="items-center justify-between w-full md:flex md:w-auto md:order-1"> <ul class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0"> <li> <a href="/" data-astro-cid-eimmu3lg> Home </a>  </li><li> <a href="/blog/en" data-astro-cid-eimmu3lg> Blog </a>  </li><li> <a href="/about" data-astro-cid-eimmu3lg> About </a>  </li> </ul> </div> </div> </nav> </header> <main> <article>  <div class="prose m-auto p-4"> <div class="title"> <div class="date">  </div> <h1 class="block gradient-title-en">WebSocket and React</h1> <hr class="m-2"> </div> <div class="space-x-1 text-sm dark:text-gray-500 mb-2 flex flex-wrap items-center"> 4 years ago - &nbsp;<time datetime="2020-03-08T23:46:37.121Z">March 8, 2020</time> </div> <div class="tags"> <span class="dark:text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">React</span><span class="dark:text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">Realtime</span><span class="dark:text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">SignalR</span><span class="dark:text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">ASP.NET Core</span><span class="dark:text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">Node.js</span> </div> <section class="main-body text-zinc-600 dark:text-zinc-400">  <p>WebSocket is a communication protocol. It’s bidirectional in nature which means that either client or server can send data at any time. With WebSocket, we can build applications such as multiplayer games, chat apps, collaboration software that work on the open web. In this blog, I going to show you how to create a WebSocket server both in .NET Core and Node.js. I’ll start with the Node.js version as it’s a bit easier (boilerplate code for it is just 13 lines of code).</p>
<h2 id="websocket-server-nodejs">WebSocket Server (Node.js)</h2>
<p>To create a WebSocket server in Node.js we need to install a third-party package called <code>socket.io</code> which is pretty popular. So follow these steps to create the server:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>mkdir -p websocket/node &#x26;&#x26; cd "$_"</span></span>
<span class="line"><span>yarn init -y</span></span>
<span class="line"><span>yarn add express socket.io</span></span>
<span class="line"><span>touch index.js</span></span></code></pre>
<p>Now open <code>index.js</code> and add the following code:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> app</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> require</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"express"</span><span style="color:#E1E4E8">)();</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> http</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> require</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"http"</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">createServer</span><span style="color:#E1E4E8">(app);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> io</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> require</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"socket.io"</span><span style="color:#E1E4E8">)(http);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">io.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"connection"</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">socket</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  socket.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">message</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    socket.broadcast.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">, message);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">http.</span><span style="color:#B392F0">listen</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8080</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"listening on *:8080"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>As you can see we have initialized a new instance of <code>socket.io</code> using <code>http</code>. Then we added an event listener for the <code>connection</code> event. This keeps listening to any incoming WebSocket connection so whenever a new WebSocket connection is established from the client, the callback is invoked. Inside the callback again we keep listening to the incoming request from the newly created connection, If the client emits an event called <code>message</code> we broadcast the data to other subscribers. That’s it, the backend part is done. Now let’s create a frontend for it.</p>
<h2 id="websocket-client">WebSocket Client</h2>
<p>I don’t want to explain the process of creating a React app as it’s pretty easy to scaffold a React application using <code>create-react-app</code>. So let’s assume that we have an existing application and want to add chat functionality to it. First, make sure you have installed <code>socket.io-client</code> package. I should also mention that I’m going to use Bootstrap for stylying the components. What we are going to build is this widget:</p>
<img class="img-res" src="/img/chat.png" alt="Chat">
<p>To create such component I’ll break it down into two separate components, one for each single message and the other for the chat widget. So let’s go ahead and create them:</p>
<h3 id="message-component">Message component</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> React </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "react"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> user </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "../Assets/user.png"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> ({ </span><span style="color:#FFAB70">userName</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">message</span><span style="color:#E1E4E8"> }) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"media"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">img</span></span>
<span class="line"><span style="color:#B392F0">          className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"rounded-circle align-self-start mr-3"</span></span>
<span class="line"><span style="color:#B392F0">          src</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{user}</span></span>
<span class="line"><span style="color:#B392F0">          alt</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"Avatar"</span></span>
<span class="line"><span style="color:#E1E4E8">        /></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"media-body"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">          &#x3C;</span><span style="color:#85E89D">h5</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"mt-0"</span><span style="color:#E1E4E8">>{userName}&#x3C;/</span><span style="color:#85E89D">h5</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">          &#x3C;</span><span style="color:#85E89D">p</span><span style="color:#E1E4E8">>{message}&#x3C;/</span><span style="color:#85E89D">p</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"dropdown-divider"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<h3 id="chat-component">Chat component</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> React, { useState, useEffect } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "react"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#9ECBFF"> "./Chat.css"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> Message </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "./Message"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> socketIOClient </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "socket.io-client"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> socket</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> socketIOClient</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"http://localhost:8080"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">userName</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">setUserName</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> useState</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">message</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">setMessage</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> useState</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">messages</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">setMessages</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> useState</span><span style="color:#E1E4E8">([]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  useEffect</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> uName</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> prompt</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Name?"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (uName) {</span></span>
<span class="line"><span style="color:#B392F0">      setUserName</span><span style="color:#E1E4E8">(uName);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }, []);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  socket.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">message</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    setMessages</span><span style="color:#E1E4E8">([</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">messages, message]);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"wrapper"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"card border-primary"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">h5</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"card-header bg-primary text-white"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">          &#x3C;</span><span style="color:#85E89D">i</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"fas fa-comment"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">i</span><span style="color:#E1E4E8">> Chat</span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;/</span><span style="color:#85E89D">h5</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"card-body overflow-auto"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">          {messages.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">msg</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">index</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">            &#x3C;</span><span style="color:#79B8FF">Message</span></span>
<span class="line"><span style="color:#B392F0">              key</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{index}</span></span>
<span class="line"><span style="color:#B392F0">              userName</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{msg.userName}</span></span>
<span class="line"><span style="color:#B392F0">              message</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{msg.message}</span></span>
<span class="line"><span style="color:#E1E4E8">            /></span></span>
<span class="line"><span style="color:#E1E4E8">          ))}</span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"card-footer border-primary p-0"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">          &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"input-group"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">            &#x3C;</span><span style="color:#85E89D">input</span></span>
<span class="line"><span style="color:#B392F0">              value</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{message}</span></span>
<span class="line"><span style="color:#B392F0">              onChange</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{(</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">                setMessage</span><span style="color:#E1E4E8">(e.target.value);</span></span>
<span class="line"><span style="color:#E1E4E8">              }}</span></span>
<span class="line"><span style="color:#B392F0">              type</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"text"</span></span>
<span class="line"><span style="color:#B392F0">              className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"form-control input-sm"</span></span>
<span class="line"><span style="color:#B392F0">              placeholder</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"Type your message here..."</span></span>
<span class="line"><span style="color:#E1E4E8">            /></span></span>
<span class="line"><span style="color:#E1E4E8">            &#x3C;</span><span style="color:#85E89D">button</span></span>
<span class="line"><span style="color:#B392F0">              className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"btn btn-primary btn-sm"</span></span>
<span class="line"><span style="color:#B392F0">              onClick</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{(</span><span style="color:#FFAB70">_</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">                const</span><span style="color:#79B8FF"> msg</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">                  id: Math.</span><span style="color:#B392F0">random</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                  message,</span></span>
<span class="line"><span style="color:#E1E4E8">                  userName: userName,</span></span>
<span class="line"><span style="color:#E1E4E8">                };</span></span>
<span class="line"><span style="color:#B392F0">                setMessages</span><span style="color:#E1E4E8">([</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">messages, msg]);</span></span>
<span class="line"><span style="color:#B392F0">                setMessage</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">                socket.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">, msg);</span></span>
<span class="line"><span style="color:#E1E4E8">              }}</span></span>
<span class="line"><span style="color:#E1E4E8">            ></span></span>
<span class="line"><span style="color:#E1E4E8">              Send</span></span>
<span class="line"><span style="color:#E1E4E8">            &#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">          &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<p>As you can see we first imported <code>socket.io</code>. Then there are three parts to make it work. The first part is to connect to our WebSocket server:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> socketIOClient </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "socket.io-client"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> socket</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> socketIOClient</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"http://localhost:8080"</span><span style="color:#E1E4E8">);</span></span></code></pre>
<p>The second part is to listen to incoming messages from the backend. As soon as there is a new message we save it into our local state:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">socket.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">message</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  setMessages</span><span style="color:#E1E4E8">([</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">messages, message]);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>The third part is when we click on <code>Send</code> button which is simply emitting a new message to the WebSocket server:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">socket.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">, msg);</span></span></code></pre>
<p>That’s it. We just built a simple chat application in just a few minutes. Now let’s create the same functionality using .NET Core.</p>
<h2 id="websocket-server-net-core">WebSocket Server (.NET Core)</h2>
<p>To create a WebSocket server in .NET Core we should use SignalR as it’s incredibly simple yet powerful library to create real-time web applications. So let’s type in the following commands to create a project:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>mkdir -p websocket/dotnet &#x26;&#x26; cd "$_"</span></span>
<span class="line"><span>dotnet new web</span></span></code></pre>
<p>Next we need something called <code>Hub</code> which is a class for listening and emitting data to subscribers. So let’s create a Hub called <code>ChatHub</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ChatHub</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">Hub</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> Task</span><span style="color:#B392F0"> Message</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">MessageModel</span><span style="color:#B392F0"> message</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#F97583">        await</span><span style="color:#E1E4E8"> Clients.Others.</span><span style="color:#B392F0">SendAsync</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">, message);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> MessageModel</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> string</span><span style="color:#B392F0"> UserName</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">get</span><span style="color:#E1E4E8">; </span><span style="color:#F97583">set</span><span style="color:#E1E4E8">; }</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> string</span><span style="color:#B392F0"> Message</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">get</span><span style="color:#E1E4E8">; </span><span style="color:#F97583">set</span><span style="color:#E1E4E8">; }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Then we will need to configure the server to respond to WebSocket requests. So let’s change <code>Startup.cs</code> as the following:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Startup</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> ConfigureServices</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">IServiceCollection</span><span style="color:#B392F0"> services</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#E1E4E8">        services.</span><span style="color:#B392F0">AddCors</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">o</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> o.</span><span style="color:#B392F0">AddPolicy</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"CorsPolicy"</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">builder</span><span style="color:#F97583"> =></span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#E1E4E8">            builder</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">AllowAnyMethod</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">AllowAnyHeader</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">WithOrigins</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"http://localhost:3000"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        }));</span></span>
<span class="line"><span style="color:#E1E4E8">        services.</span><span style="color:#B392F0">AddSignalR</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> Configure</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">IApplicationBuilder</span><span style="color:#B392F0"> app</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">IWebHostEnvironment</span><span style="color:#B392F0"> env</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#E1E4E8">        app.</span><span style="color:#B392F0">UseCors</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"CorsPolicy"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        app.</span><span style="color:#B392F0">UseRouting</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        app.</span><span style="color:#B392F0">UseEndpoints</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">endpoints</span><span style="color:#F97583"> =></span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#E1E4E8">            endpoints.</span><span style="color:#B392F0">MapHub</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">ChatHub</span><span style="color:#E1E4E8">>(</span><span style="color:#9ECBFF">"/chatHub"</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">options</span><span style="color:#F97583"> =></span></span>
<span class="line"><span style="color:#E1E4E8">            {</span></span>
<span class="line"><span style="color:#E1E4E8">                options.Transports </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> HttpTransportType.WebSockets;</span></span>
<span class="line"><span style="color:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>It worth mentioning that SignalR includes some built-in transports to keep the underlying connection open. It means that it automatically chooses the most efficient transport type during an initial stage called negotiation. In the code, we have purposely set <code>WebSockets</code> transport by passing in a second argument to <code>MapHub</code> method. This is because the main focus of this blog post. But you can set other supported transports if you want to, If you don’t explicitly set the transports, SignalR will use the most efficient type for you as mentioned. That’s it. The server is now ready to communicate with the client. Unfortunately, the client part needs a couple of changes as the <code>socket.io-client</code> package doesn’t support SignalR for its server as they are different in implementation. It means that we need to change the client code and the way it communicates with the server. First, we need to install an official Microsoft package:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>yarn add @microsoft/signalr</span></span></code></pre>
<p>Since the component structure is almost the same with one we had in <code>socket.io-client</code> so I’ll just add the differences. First we need to import the SignalR package:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  HubConnectionBuilder,</span></span>
<span class="line"><span style="color:#E1E4E8">  LogLevel,</span></span>
<span class="line"><span style="color:#E1E4E8">  HttpTransportType,</span></span>
<span class="line"><span style="color:#E1E4E8">} </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "@microsoft/signalr"</span><span style="color:#E1E4E8">;</span></span></code></pre>
<p>Then we need to have a way to initialize and open the connection. We could do that by defining a <code>useEffect</code> hook:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">connection</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">setConnection</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> useState</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">useEffect</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#B392F0">  configSocket</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">  // as before</span></span>
<span class="line"><span style="color:#E1E4E8">}, []);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> configSocket</span><span style="color:#F97583"> =</span><span style="color:#F97583"> async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> socketConnection</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> HubConnectionBuilder</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">configureLogging</span><span style="color:#E1E4E8">(LogLevel.Debug)</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">withUrl</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"http://localhost:5000/chatHub"</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#E1E4E8">      skipNegotiation: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      transport: HttpTransportType.WebSockets,</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> socketConnection.</span><span style="color:#B392F0">start</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">  setConnection</span><span style="color:#E1E4E8">(socketConnection);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>We only want to initialize <code>connection</code> when the component mounts that’s why we provided an empty array as a second argument for the effect hook. Next we need to listen to any incoming message:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">connection </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#E1E4E8">  connection.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">message</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    setMessages</span><span style="color:#E1E4E8">([</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">messages, message]);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span></code></pre>
<p>As the final step we need a way to emit the messages when a user clicks on <code>Send</code> button:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">button</span></span>
<span class="line"><span style="color:#B392F0">  className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"btn btn-primary btn-sm"</span></span>
<span class="line"><span style="color:#B392F0">  onClick</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{(</span><span style="color:#FFAB70">_</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // as before</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    connection </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> connection.</span><span style="color:#B392F0">invoke</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">, msg);</span></span>
<span class="line"><span style="color:#E1E4E8">  }}</span></span>
<span class="line"><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  Send</span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span></code></pre>
<p>That’s all we need to do to configure SignalR into our React application. Now you can run the project and see the result:</p>
<img class="img-res" src="/img/chat-demo.gif" alt="Chat">
<br>
<p><strong>Note</strong>: If you want to host the SignalR server on IIS you will have to enable WebSocket on IIS because it’s not enabled by default. You can follow <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/websockets?view=aspnetcore-3.1#iisiis-express-support">this process</a> to enable it:</p>
<img class="img-res" src="/img/IIS_WebSocket.png" alt="Enabling WebSockets on IIS">
<br>
<p>Source code (<a href="https://github.com/SirwanAfifi/realtime">https://github.com/SirwanAfifi/realtime</a>)</p>  </section> <hr> </div> </article> </main> <footer data-astro-cid-sz7xmlte> <span class="text-zinc-600 dark:text-zinc-400" data-astro-cid-sz7xmlte>
&copy; 2024 Sirwan Afifi. All rights reserved.
</span> <div class="social-links" data-astro-cid-sz7xmlte> <a href="https://twitter.com/SirwanAfifi" target="_blank" data-astro-cid-sz7xmlte> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" class="fill-zinc-500 hover:fill-white transition-colors duration-200" data-astro-cid-sz7xmlte><path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/SirwanAfifi" target="_blank" data-astro-cid-sz7xmlte> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" class="fill-zinc-500 hover:fill-white tr" data-astro-cid-sz7xmlte><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> </div> </footer>  </body></html>