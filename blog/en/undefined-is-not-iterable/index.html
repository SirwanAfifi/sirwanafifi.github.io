<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.13.4"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://sirwan.info/blog/en/undefined-is-not-iterable/"><!-- Primary Meta Tags --><title>بررسی خطای undefined is not iterable در JavaScript</title><meta name="title" content="بررسی خطای undefined is not iterable در JavaScript"><meta name="description" content="Iteratorها این امکان را به ما میدهند که بر روی یک مجموعه iterator کنیم؛ به شرطی که مجموعه iterable باشد؛ در JS مقادیر زیر iterable هستند به این معنا که میتوانیم آیتم‌ها را یکی یکی پیمایش کنیم:"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://sirwan.info/blog/en/undefined-is-not-iterable/"><meta property="og:title" content="بررسی خطای undefined is not iterable در JavaScript"><meta property="og:description" content="Iteratorها این امکان را به ما میدهند که بر روی یک مجموعه iterator کنیم؛ به شرطی که مجموعه iterable باشد؛ در JS مقادیر زیر iterable هستند به این معنا که میتوانیم آیتم‌ها را یکی یکی پیمایش کنیم:"><meta property="og:image" content="https://sirwan.info/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://sirwan.info/blog/en/undefined-is-not-iterable/"><meta property="twitter:title" content="بررسی خطای undefined is not iterable در JavaScript"><meta property="twitter:description" content="Iteratorها این امکان را به ما میدهند که بر روی یک مجموعه iterator کنیم؛ به شرطی که مجموعه iterable باشد؛ در JS مقادیر زیر iterable هستند به این معنا که میتوانیم آیتم‌ها را یکی یکی پیمایش کنیم:"><meta property="twitter:image" content="https://sirwan.info/blog-placeholder-1.jpg"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><style>
			main {
				:not(:has(code)) {
					direction: rtl;
					text-align: right;
				}
			}
		</style><link rel="stylesheet" href="/assets/about.BrEw3eNp.css">
<link rel="stylesheet" href="/assets/about.vwAuAIlu.css">
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}
footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
</style><script type="module" src="/assets/hoisted.D-2wbxhY.js"></script></head> <body class="antialiased bg-zinc-900"> <header class="mb-30"> <nav class="w-full z-20 top-0 start-0 border-b border-gray-200 text-white dark:text-emerald-400"> <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"> <a href="/" class="flex items-center space-x-3 rtl:space-x-reverse"></a> <div class="flex md:order-2 space-x-3 md:space-x-0 rtl:space-x-reverse"></div> <div class="items-center justify-between w-full md:flex md:w-auto md:order-1"> <ul class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0"> <li> <a href="/" data-astro-cid-eimmu3lg> خانه </a>  </li><li> <a href="/blog/fa" data-astro-cid-eimmu3lg> وبلاگ </a>  </li><li> <a href="/about" data-astro-cid-eimmu3lg> درباره </a>  </li><li> <a href="/now" data-astro-cid-eimmu3lg> الان چیکار میکنم؟ </a>  </li> </ul> </div> </div> </nav> </header> <main> <article>  <div class="prose m-auto p-4"> <div class="title"> <div class="date">  </div> <h1 class="block gradient-title-fa">بررسی خطای undefined is not iterable در JavaScript</h1> <hr class="m-2"> </div> <div class="space-x-1 text-sm text-gray-500 mb-2 flex flex-wrap items-center"> ۲ سال پیش - &nbsp;<time datetime="2022-06-03T23:46:37.121Z">۱۴ خرداد ۱۴۰۱</time> </div> <div class="tags"> <span class="text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">JavaScript</span><span class="text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">TypeScript</span> </div> <section class="main-body text-zinc-400">  <p>توی یکی از پروژه‌هایی که کار میکنم یه خطایی رو دریافت کردم که توسط TypeScript به اصطلاح catch نشد اما قبل از اینکه اصل مطلب رو بگم میخواستم مروری بر Iterable و iteratorها داشته باشیم. Iteratorها این امکان را به ما میدهند که بر روی یک مجموعه iterator کنیم؛ به شرطی که مجموعه iterable باشد؛ در JS مقادیر زیر iterable هستند به این معنا که میتوانیم آیتم‌ها را یکی یکی پیمایش کنیم:</p>
<div dir="ltr">
<ul>
<li>Arrays</li>
<li>Strings</li>
<li>Maps</li>
<li>Sets</li>
<li>DOM data structure</li>
</ul>
</div>
<p>مثال:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// Arrays</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> item </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"UserA"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"UserB"</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(item);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Strings</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> item </span><span style="color:#F97583">of</span><span style="color:#9ECBFF"> "Sirwan"</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(item);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Maps</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> item </span><span style="color:#F97583">of</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map</span><span style="color:#E1E4E8">([</span></span>
<span class="line"><span style="color:#E1E4E8">  [</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"UserA"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">  [</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"UserB"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">])) {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(item);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Sets</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> item </span><span style="color:#F97583">of</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Set</span><span style="color:#E1E4E8">([</span><span style="color:#9ECBFF">"Sirwan"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Sirwan"</span><span style="color:#E1E4E8">])) {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(item);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// DOM data structure</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> el </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> document.</span><span style="color:#B392F0">querySelectorAll</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"p"</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(el);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>این قابلیت نیز از طریق یک متد که کلیدش Symbol.iterator است اتفاق میفتد؛ در واقع میتوانیم بگوئیم که تمامی مقادیر فوق این قرارداد را پیاده‌سازی کرده‌اند.</p>
 <img src="/img/symbol-iterator.jpg" alt="symbol-iterator">
<p>خروجی این متد نیز یک ساختار مشخص داره؛ در واقع یک متد به اسم next رو expose میکنه که خروجی این متد نیز یک آبجکت هست که شامل دو پراپرتی value, done هست؛ loop هم تا زمانی که مقدار done به false ست نشده iteration رو ادامه میده که در اینصورت مقدار value نیز به undefined ست خواهد شد:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> names</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"UserA"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"UserB"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"UserC"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> iterator</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> names[Symbol.iterator]();</span></span>
<span class="line"><span style="color:#E1E4E8">iterator.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: "UserA", done: false }</span></span>
<span class="line"><span style="color:#E1E4E8">iterator.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: "UserB", done: false }</span></span>
<span class="line"><span style="color:#E1E4E8">iterator.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: "UserC", done: false }</span></span>
<span class="line"><span style="color:#E1E4E8">iterator.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: undefined, done: true }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> myName</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "Sirwan"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> iterator2</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> myName[Symbol.iterator]();</span></span>
<span class="line"><span style="color:#E1E4E8">iterator2.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: "S", done: false }</span></span>
<span class="line"><span style="color:#E1E4E8">iterator2.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: "i", done: false }</span></span>
<span class="line"><span style="color:#E1E4E8">iterator2.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: "r", done: false }</span></span>
<span class="line"><span style="color:#E1E4E8">iterator2.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: "w", done: false }</span></span>
<span class="line"><span style="color:#E1E4E8">iterator2.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: "a", done: false }</span></span>
<span class="line"><span style="color:#E1E4E8">iterator2.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: "n", done: false }</span></span>
<span class="line"><span style="color:#E1E4E8">iterator2.</span><span style="color:#B392F0">next</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// { value: undefined, done: true }</span></span>
<span class="line"></span></code></pre>
<p>و اما خطایی که دریافت کردم چی بود؟ همونطور که از عنوان مطلب نیز مشخصه مقدار undefined این قرارداد رو پیاده‌سازی نکرده چون عملاً undefined در JS هیچ چیزی نیست و همونطور که از اسمش مشخصه undefined است.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">TypeError</span><span style="color:#E1E4E8"> (intermediate value)(</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">) is not a </span><span style="color:#F97583">function</span><span style="color:#B392F0"> in</span><span style="color:#B392F0"> JS</span></span>
<span class="line"></span></code></pre>
<p>این خطا موقع اجرای این قطعه کد اتفاق میفتاد:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> whereClause</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  ...</span><span style="color:#E1E4E8">(title </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    OR: [{ title: { contains: title } }, { description: { contains: title } }],</span></span>
<span class="line"><span style="color:#E1E4E8">  }),</span></span>
<span class="line"><span style="color:#E1E4E8">  AND: [</span></span>
<span class="line"><span style="color:#F97583">    ...</span><span style="color:#E1E4E8">(status_ids </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#E1E4E8">      status_ids.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ></span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#E1E4E8">          status_id: {</span></span>
<span class="line"><span style="color:#E1E4E8">            in: status_ids </span><span style="color:#F97583">as</span><span style="color:#79B8FF"> number</span><span style="color:#E1E4E8">[],</span></span>
<span class="line"><span style="color:#E1E4E8">          },</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">      ]),</span></span>
<span class="line"><span style="color:#F97583">    ...</span><span style="color:#E1E4E8">(user_id </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> user_id </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> [{ user_id }]),</span></span>
<span class="line"><span style="color:#E1E4E8">  ],</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>این کوئری کار زیاد خاصی انجام نمیده؛ هدف ساختن یک کوئری براساس فیلتر کاربر است. مشکل این بود که موقع spread کردن status_ids که به صورت conditional انجام شده، مقدار status_ids ممکنه یک آرایه خالی باشه چون کاربر ممکنه هیچ statusی رو موقع فیلتر کردن انتخاب نکنه. در نتیجه کد فوق اینطوری برای engine در نظر گرفته میشه:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> whereClause</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  // as before</span></span>
<span class="line"><span style="color:#E1E4E8">  AND: [</span><span style="color:#F97583">...</span><span style="color:#79B8FF">undefined</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">...</span><span style="color:#E1E4E8">(user_id </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> user_id </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> [{ user_id }])],</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>از اونجائیکه undefined هم iterable نیست در نتیجه خطای عنوان شده توسط engine صادر میشه.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#E1E4E8">(status_ids </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> (status_ids.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ></span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> [{(intermediate value)}]) is not iterable</span></span>
<span class="line"></span></code></pre>
<p>همین کد قبلی رو اگر با TypeScript تست کنید میتونید خطا رو موقع compile time مشاهده کنید:</p>
<img src="/img/undefined-is-not-iterable.jpg" alt="undefined-is-not-iterable">
<p>spread operator هم همونطور که میدونید کاری که انجام میده insert کردن مقادیر یک iterable داخل یک آرایه هستش یعنی این قطعه کد:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> names</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"UserA"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"UserB"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"UserC"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> newNames</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">names];</span></span>
<span class="line"></span></code></pre>
<p>توسط TypeScript در نهایت به همچین خروجی تبدیل میشه (ES5):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#9ECBFF">"use strict"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> __spreadArray </span><span style="color:#F97583">=</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span><span style="color:#79B8FF">this</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.__spreadArray) </span><span style="color:#F97583">||</span></span>
<span class="line"><span style="color:#F97583">  function</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">to</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">from</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">pack</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (pack </span><span style="color:#F97583">||</span><span style="color:#79B8FF"> arguments</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ===</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">      for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">, l </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> from.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">, ar; i </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> l; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (ar </span><span style="color:#F97583">||</span><span style="color:#F97583"> !</span><span style="color:#E1E4E8">(i </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> from)) {</span></span>
<span class="line"><span style="color:#F97583">          if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">ar) ar </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> Array</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">prototype</span><span style="color:#E1E4E8">.slice.</span><span style="color:#B392F0">call</span><span style="color:#E1E4E8">(from, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, i);</span></span>
<span class="line"><span style="color:#E1E4E8">          ar[i] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> from[i];</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> to.</span><span style="color:#B392F0">concat</span><span style="color:#E1E4E8">(ar </span><span style="color:#F97583">||</span><span style="color:#79B8FF"> Array</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">prototype</span><span style="color:#E1E4E8">.slice.</span><span style="color:#B392F0">call</span><span style="color:#E1E4E8">(from));</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> names </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"UserA"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"UserB"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"UserC"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> newNames </span><span style="color:#F97583">=</span><span style="color:#B392F0"> __spreadArray</span><span style="color:#E1E4E8">([], names, </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
<p>راه‌حل ساده برای این خطا اینکه یه fallback برای اون قسمت از کد بذاریم که اگر نتیجه عبارت undefined شد یک آرایه خالی رو spread کنه:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> whereClause</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  ...</span><span style="color:#E1E4E8">(title </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    OR: [{ title: { contains: title } }, { description: { contains: title } }],</span></span>
<span class="line"><span style="color:#E1E4E8">  }),</span></span>
<span class="line"><span style="color:#E1E4E8">  AND: [</span></span>
<span class="line"><span style="color:#F97583">    ...</span><span style="color:#E1E4E8">((status_ids </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#E1E4E8">      status_ids.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ></span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#E1E4E8">          status_id: {</span></span>
<span class="line"><span style="color:#E1E4E8">            in: status_ids </span><span style="color:#F97583">as</span><span style="color:#79B8FF"> number</span><span style="color:#E1E4E8">[],</span></span>
<span class="line"><span style="color:#E1E4E8">          },</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">      ]) </span><span style="color:#F97583">||</span></span>
<span class="line"><span style="color:#E1E4E8">      []),</span></span>
<span class="line"><span style="color:#F97583">    ...</span><span style="color:#E1E4E8">(user_id </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> user_id </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> [{ user_id }]),</span></span>
<span class="line"><span style="color:#E1E4E8">  ],</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>اما بهتر بود TypeScript هم موقع نوشتن کد این خطا رو بهم نشون میداد؛ قاعدتاً باید نشون میداد ولی چون برای این پروژه از express استفاده کرده بودم؛ مقدار req.body به صورت پیش‌فرض به any ست شده و برای any هم هیچ محدودیتی وجود نداره؛ برای حل مشکل مقدار ورودی که از body گرفته میشد رو به typeی که مدنظرم بود cast کردم و خطا همونطور که انتظار داشتم نشون داده شد:</p>
<img src="/img/cast-body-symbol.jpg" alt="cast-body-symbol">
<p>توی چیزی مثل NestJS این موارد خیلی سریع قابل‌حل هستن چون به نوعی طبق convention پیشنهاد میده ورودی‌ها رو typeدار کنیم:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#B392F0">Post</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">(@</span><span style="color:#B392F0">Body</span><span style="color:#E1E4E8">() filterInput: FilterInputDto) {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">title</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">user_id</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">status_ids</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> filterInput;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // other code</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>اما در حالت استفاده از express به صورت خام باید حواسمون به همچین شرایطی باشه.</p>  </section> <hr> </div> </article> </main> <footer data-astro-cid-sz7xmlte> <span class="text-zinc-600 dark:text-zinc-400" data-astro-cid-sz7xmlte>
&copy; 2024 Sirwan Afifi. All rights reserved.
</span> <div class="social-links" data-astro-cid-sz7xmlte> <a href="https://twitter.com/SirwanAfifi" target="_blank" data-astro-cid-sz7xmlte> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" class="fill-zinc-500 hover:fill-white transition-colors duration-200" data-astro-cid-sz7xmlte><path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/SirwanAfifi" target="_blank" data-astro-cid-sz7xmlte> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" class="fill-zinc-500 hover:fill-white tr" data-astro-cid-sz7xmlte><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> </div> </footer>  </body></html>