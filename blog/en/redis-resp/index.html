<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.13.4"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://sirwan.info/blog/en/redis-resp/"><!-- Primary Meta Tags --><title>Redis RESP</title><meta name="title" content="Redis RESP"><meta name="description" content="RESP (REdis Serialization Protocol) is a binary protocol that Redis uses to communicate with clients. It is a simple protocol that is easy to implement in any programming language. This means that we can communicate with Redis over a socket connection. For instance, here is a naive implementation in C# that sends a command to Redis and reads the response:"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://sirwan.info/blog/en/redis-resp/"><meta property="og:title" content="Redis RESP"><meta property="og:description" content="RESP (REdis Serialization Protocol) is a binary protocol that Redis uses to communicate with clients. It is a simple protocol that is easy to implement in any programming language. This means that we can communicate with Redis over a socket connection. For instance, here is a naive implementation in C# that sends a command to Redis and reads the response:"><meta property="og:image" content="https://sirwan.info/img/redis/redka-schema.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://sirwan.info/blog/en/redis-resp/"><meta property="twitter:title" content="Redis RESP"><meta property="twitter:description" content="RESP (REdis Serialization Protocol) is a binary protocol that Redis uses to communicate with clients. It is a simple protocol that is easy to implement in any programming language. This means that we can communicate with Redis over a socket connection. For instance, here is a naive implementation in C# that sends a command to Redis and reads the response:"><meta property="twitter:image" content="https://sirwan.info/img/redis/redka-schema.png"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/assets/about.CppRrgSZ.css">
<link rel="stylesheet" href="/assets/about.CBOTxGiB.css">
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}
footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
</style><script type="module" src="/assets/hoisted.D-2wbxhY.js"></script></head> <body class="bg-white antialiased dark:bg-zinc-900"> <header class="mb-30"> <nav class="w-full z-20 top-0 start-0 border-b border-gray-200 text-white dark:text-emerald-400"> <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"> <a href="/" class="flex items-center space-x-3 rtl:space-x-reverse"></a> <div class="flex md:order-2 space-x-3 md:space-x-0 rtl:space-x-reverse"></div> <div class="items-center justify-between w-full md:flex md:w-auto md:order-1"> <ul class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0"> <li> <a href="/" data-astro-cid-eimmu3lg> Home </a>  </li><li> <a href="/blog/en" data-astro-cid-eimmu3lg> Blog </a>  </li><li> <a href="/about" data-astro-cid-eimmu3lg> About </a>  </li> </ul> </div> </div> </nav> </header> <main> <article>  <div class="prose m-auto p-4"> <div class="title"> <div class="date">  </div> <h1 class="block gradient-title-en">Redis RESP</h1> <hr class="m-2"> </div> <div class="space-x-1 text-sm dark:text-gray-500 mb-2 flex flex-wrap items-center"> 4 months ago - &nbsp;<time datetime="2024-04-17">April 17, 2024</time> </div> <div class="tags"> <span class="dark:text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">Redis</span><span class="dark:text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">RESP</span> </div> <section class="main-body text-zinc-600 dark:text-zinc-400">  <p><a href="https://github.com/antirez/RESP3/blob/master/spec.md">RESP</a> (REdis Serialization Protocol) is a binary protocol that Redis uses to communicate with clients. It is a simple protocol that is easy to implement in any programming language. This means that we can communicate with Redis over a socket connection. For instance, here is a naive implementation in C# that sends a command to Redis and reads the response:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> RESPClient</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">string</span><span style="color:#B392F0"> host</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#B392F0"> port</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> string</span><span style="color:#B392F0"> Host</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">get</span><span style="color:#E1E4E8">; } </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> host;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> int</span><span style="color:#B392F0"> Port</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">get</span><span style="color:#E1E4E8">; } </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> port;</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> string</span><span style="color:#B392F0"> Send</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">string</span><span style="color:#B392F0"> command</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#F97583">        using</span><span style="color:#F97583"> var</span><span style="color:#B392F0"> client</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TcpClient</span><span style="color:#E1E4E8">(Host, Port);</span></span>
<span class="line"><span style="color:#F97583">        var</span><span style="color:#B392F0"> stream</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> client.</span><span style="color:#B392F0">GetStream</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">        var</span><span style="color:#B392F0"> data</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Encoding.UTF8.</span><span style="color:#B392F0">GetBytes</span><span style="color:#E1E4E8">(command </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\r\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        stream.</span><span style="color:#B392F0">Write</span><span style="color:#E1E4E8">(data, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, data.Length);</span></span>
<span class="line"><span style="color:#F97583">        var</span><span style="color:#B392F0"> buffer</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#F97583"> byte</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">1024</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#F97583">        var</span><span style="color:#B392F0"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> StringBuilder</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">        var</span><span style="color:#B392F0"> bytesRead</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> stream.</span><span style="color:#B392F0">Read</span><span style="color:#E1E4E8">(buffer, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, buffer.Length);</span></span>
<span class="line"><span style="color:#E1E4E8">        response.</span><span style="color:#B392F0">Append</span><span style="color:#E1E4E8">(Encoding.UTF8.</span><span style="color:#B392F0">GetString</span><span style="color:#E1E4E8">(buffer, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, bytesRead));</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> response.</span><span style="color:#B392F0">ToString</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>There are lots of edge cases to consider, which is why there are libraries like <a href="https://github.com/StackExchange/StackExchange.Redis">StackExchange.Redis</a> that handle all the complexities for you. However, it’s good to know how things work under the hood. This is especially relevant because Redis has recently announced a new policy involving two types of licenses, and people are unhappy about it and trying to find alternatives. When choosing an alternative, it’s really important to pick one that is <a href="https://github.dev/StackExchange/StackExchange.Redis">RESP compatible</a>, meaning you can easily interact with them using the existing redis-cli. For instance, <a href="https://stackexchange.github.io/StackExchange.Redis/Resp3">StackExchange.Redis is RESP compatible</a>, so if you choose to switch to, for instance, redka, you can do so without changing your codebase, and it’s basically a drop-in replacement. The same goes for Apache’s implementation of Redis called kvrocks, which is also RESP compatible.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> docker run --name redka -p 6379:6379 -d nalgeon/redka</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> docker exec -it redka sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> docker run --name kvrocks -p 6379:6666 -d apache/kvrocks</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> docker exec -it kvrocks sh</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> redis-cli -p 6666</span></span>
<span class="line"></span></code></pre>
<p>By the way, you might not want to use <code>redka</code> as it’s 2-6 times slower than a key-value store because it uses a relational database. However, it can handle 22K writes per second and 57K reads per second. If you’re curious about how it stores the data, you can copy the SQLite database and look at the table structures:</p>
<img src="/img/redis/redka-schema.png" alt="Redka Schema" class="blog-post-image">
<p>You can query the views to see the data.</p>  </section> <hr> </div> </article> </main> <footer data-astro-cid-sz7xmlte> <span class="text-zinc-600 dark:text-zinc-400" data-astro-cid-sz7xmlte>
&copy; 2024 Sirwan Afifi. All rights reserved.
</span> <div class="social-links" data-astro-cid-sz7xmlte> <a href="https://twitter.com/SirwanAfifi" target="_blank" data-astro-cid-sz7xmlte> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" class="fill-zinc-500 hover:fill-white transition-colors duration-200" data-astro-cid-sz7xmlte><path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/SirwanAfifi" target="_blank" data-astro-cid-sz7xmlte> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" class="fill-zinc-500 hover:fill-white tr" data-astro-cid-sz7xmlte><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> </div> </footer>  </body></html>