<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.13.4"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://sirwan.info/blog/ku/azure-api-management/"><!-- Primary Meta Tags --><title>Azure API Management</title><meta name="title" content="Azure API Management"><meta name="description" content="I have been playing around with Azure API Management lately and really like it. It's a great way to manage your APIs, essentially serving as an API Gateway to handle incoming API calls and route them to various backend services. The backend service could be any HTTP API, WebSocket, GraphQL, Azure Function, Azure App Services, etc."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://sirwan.info/blog/ku/azure-api-management/"><meta property="og:title" content="Azure API Management"><meta property="og:description" content="I have been playing around with Azure API Management lately and really like it. It's a great way to manage your APIs, essentially serving as an API Gateway to handle incoming API calls and route them to various backend services. The backend service could be any HTTP API, WebSocket, GraphQL, Azure Function, Azure App Services, etc."><meta property="og:image" content="https://sirwan.info/img/azure/azure-api-mgt.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://sirwan.info/blog/ku/azure-api-management/"><meta property="twitter:title" content="Azure API Management"><meta property="twitter:description" content="I have been playing around with Azure API Management lately and really like it. It's a great way to manage your APIs, essentially serving as an API Gateway to handle incoming API calls and route them to various backend services. The backend service could be any HTTP API, WebSocket, GraphQL, Azure Function, Azure App Services, etc."><meta property="twitter:image" content="https://sirwan.info/img/azure/azure-api-mgt.png"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/assets/about.vQU_Be1A.css">
<link rel="stylesheet" href="/assets/about.GeqxkIV0.css">
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}
footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
</style><script type="module" src="/assets/hoisted.D-2wbxhY.js"></script></head> <body class="antialiased bg-zinc-900"> <header class="mb-30"> <nav class="w-full z-20 top-0 start-0 border-b border-gray-200 text-white dark:text-emerald-400"> <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"> <a href="/" class="flex items-center space-x-3 rtl:space-x-reverse"></a> <div class="flex md:order-2 space-x-3 md:space-x-0 rtl:space-x-reverse"></div> <div class="items-center justify-between w-full md:flex md:w-auto md:order-1"> <ul class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0"> <li> <a href="/" data-astro-cid-eimmu3lg> Home </a>  </li><li> <a href="/blog/en" data-astro-cid-eimmu3lg> Blog </a>  </li><li> <a href="/about" data-astro-cid-eimmu3lg> About </a>  </li><li> <a href="/now" data-astro-cid-eimmu3lg> /now </a>  </li> </ul> </div> </div> </nav> </header> <main> <article>  <div class="prose m-auto p-4"> <div class="title"> <div class="date">  </div> <h1 class="block gradient-title-en">Azure API Management</h1> <hr class="m-2"> </div> <div class="space-x-1 text-sm text-gray-500 mb-2 flex flex-wrap items-center"> 5 months ago - &nbsp;<time datetime="2024-04-17">April 17, 2024</time> </div> <div class="tags"> <span class="text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">Azure</span><span class="text-gray-400 text-xs font-medium me-2 px-2.5 py-0.5 rounded border-dashed border-2 border-emerald-500">API Management</span> </div> <section class="main-body text-zinc-400">  <p>I have been playing around with Azure API Management lately and really like it. It’s a great way to manage your APIs, essentially serving as an API Gateway to handle incoming API calls and route them to various backend services. The backend service could be any HTTP API, WebSocket, GraphQL, Azure Function, Azure App Services, etc.</p>
<img src="/img/azure/azure-api-mgt.png" alt="Azure API Management" class="blog-post-image">
<p>I thought it might be a good idea to show you how to create a super simple API using it. A while ago, I did a side project to scrape some data from a grocery store here in the UK called Tesco. I needed the data for some other tasks; I have blogged about them <a href="/blog/en/programmers-and-llms">here</a> and <a href="/blog/en/a-weekend-with-swift/">here</a>. To demonstrate how to use Azure API Management, I will use the same data. So, let’s get started.</p>
<p>First, we need to create a new API Management instance on the Azure portal. Creating it takes time tho. Once it’s done, it comes with a default API called <code>Echo API</code>, which is a simple API with some resources:</p>
<img src="/img/azure/azure-api-mgt-echo-api.png" alt="Azure API Management" class="blog-post-image">
<p>I created an API called Tesco with these resources:
<img src="/img/azure/azure-api-mgt-tesco.png" alt="Azure API Management" class="blog-post-image"></p>
<p>As you can see I have created four resources: <code>Bakery</code>, <code>Fresh</code>, <code>Frozen</code>, and <code>List</code>. Each should correspond to their respective categories in the API:</p>
<blockquote>

















<table><thead><tr><th>Placeholder</th><th>Value</th></tr></thead><tbody><tr><td>baseURL</td><td><a href="https://raw.githubusercontent.com/SirwanAfifi/tesco-clubcards-of-the-day/main/output">https://raw.githubusercontent.com/SirwanAfifi/tesco-clubcards-of-the-day/main/output</a></td></tr><tr><td>DD-MM-yyyy</td><td>should be replaced with the current date.</td></tr></tbody></table>
</blockquote>

























<table><thead><tr><th>Resource</th><th>GitHub URL</th></tr></thead><tbody><tr><td>Bakery</td><td><code>{baseURL}/DD-MM-yyyy-bakery.json</code></td></tr><tr><td>Fresh</td><td><code>{baseURL}/DD-MM-yyyy-fresh.json</code></td></tr><tr><td>Frozen</td><td><code>{baseURL}/DD-MM-yyyy-frozen.json</code></td></tr><tr><td>List</td><td><code>{baseURL}/DD-MM-yyyy.json</code></td></tr></tbody></table>
<p>This means that we need a policy to set the placeholders. We can do this by following these steps:</p>
<img src="/img/azure/azure-api-mgt-tesco-policy.png" alt="Azure API Management" class="blog-post-image">
<p>Then for the policy, we can use the following:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">policies</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">inbound</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">set-variable</span><span style="color:#B392F0"> name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"originalUrl"</span><span style="color:#B392F0"> value</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"@(context.Request.Url.ToString())"</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">set-variable</span><span style="color:#B392F0"> name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"today"</span><span style="color:#B392F0"> value</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"@{</span></span>
<span class="line"><span style="color:#9ECBFF">            var today = DateTime.UtcNow.ToString("</span><span style="color:#E1E4E8">dd-MM-yyyy</span><span style="color:#9ECBFF">");</span></span>
<span class="line"><span style="color:#9ECBFF">            return $"</span><span style="color:#E1E4E8">/{today}-{context.Operation.Name.ToLower()}.json</span><span style="color:#9ECBFF">";</span></span>
<span class="line"><span style="color:#9ECBFF">        }"</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">rewrite-uri</span><span style="color:#B392F0"> template</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"@((string)context.Variables["</span><span style="color:#E1E4E8">today</span><span style="color:#9ECBFF">"])"</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">inbound</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">backend</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">base</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">backend</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">outbound</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">base</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">outbound</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">on-error</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">base</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">on-error</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">policies</span><span style="color:#E1E4E8">></span></span>
<span class="line"></span></code></pre>
<p>This policy sets the <code>today</code> variable to the current date and the <code>originalUrl</code> to the original URL. Then it rewrites the URI to include the current date and the operation name. The operation name is the name of the resource, which is <code>Bakery</code>, <code>Fresh</code>, <code>Frozen</code>, or <code>List</code>.</p>
<p>Now we can test the endpoints using the Test tab, or we can simply open the URL in the browser. However, to use the API, we need a subscription, which is essentially a key that we need to send as a query parameter. You can find the subscription key in the <code>Subscription</code> tab.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">curl</span><span style="color:#9ECBFF"> https://[API_NAME].azure-api.net/?subscription-key=[subscription-key]</span></span>
<span class="line"></span></code></pre>  </section> <hr> </div> </article> </main> <footer data-astro-cid-sz7xmlte> <span class="text-zinc-600 dark:text-zinc-400" data-astro-cid-sz7xmlte>
&copy; 2024 Sirwan Afifi. All rights reserved.
</span> <div class="social-links" data-astro-cid-sz7xmlte> <a href="https://twitter.com/SirwanAfifi" target="_blank" data-astro-cid-sz7xmlte> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" class="fill-zinc-500 hover:fill-white transition-colors duration-200" data-astro-cid-sz7xmlte><path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/SirwanAfifi" target="_blank" data-astro-cid-sz7xmlte> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" class="fill-zinc-500 hover:fill-white tr" data-astro-cid-sz7xmlte><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> </div> </footer>  </body></html>