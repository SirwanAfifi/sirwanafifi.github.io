{"componentChunkName":"component---src-templates-post-js","path":"/archive/2019/04/09/Hosting-react-app-on-iis/","webpackCompilationHash":"fa96f3f7c3f5c7d3696b","result":{"data":{"markdownRemark":{"frontmatter":{"formattedDate":"2019/04/09","date":"April 9th, 2019","title":"Hosting React app on IIS","tags":["React.js","Routing","IIS"],"slug":"Hosting-react-app-on-iis/"},"html":"<p>Today I wanted to host a React application; the first and easiest option was hosting the app using a package called <a href=\"https://github.com/zeit/serve\">serve</a> which is basically a static file serving tool. The process was easy, all I had to do was first prepare a production build of my application using <code class=\"language-text\">npm run build</code> then run the <code class=\"language-text\">npx serve</code> command inside my build's directory:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">cd build\nserve <span class=\"token operator\">-</span>s</code></pre></div>\n<p>This is great but the problem is that my application is using React Router and when I wanted to navigate between pages I got <code class=\"language-text\">404</code> error:</p>\n<img class=\"center-image\" src=\"/img/react-serve-404.png\" alt=\"React App 404\" width=\"700\">\n<p>based on the officail React docs:</p>\n<blockquote>\n<p>If you use routers that use the HTML5 pushState history API under the hood (for example, React Router with browserHistory), many static file servers will fail. For example, if you used React Router with a route for /todos/42, the development server will respond to localhost:3000/todos/42 properly, but an Express serving a production build as above will not. This is because when there is a fresh page load for a /todos/42, the server looks for the file build/todos/42 and does not find it. The server needs to be configured to respond to a request to /todos/42 by serving index.html</p>\n</blockquote>\n<p>So I decided to host the app on IIS and define a URL rewrite to redirect all unknown paths to <code class=\"language-text\">index.html</code>. URL Rewrite isn't installed by defualt so you must <a href=\"https://www.iis.net/downloads/microsoft/url-rewrite\">install</a> it if you haven't already. Here's what I did to host my React application:</p>\n<p>1- Adding a new website on IIS</p>\n<img class=\"center-image\" src=\"/img/create-website-react-app.png\" alt=\"Create website on IIS for React app\" width=\"700\">\n<p>2- Adding the following rule to URL rewrite:</p>\n<img class=\"center-image\" src=\"/img/url-rewite-ui.png\" alt=\"URL Rewrite UI\" width=\"700\">\n<p>As you know, this configuration is also saved in somewhere else which is the location of the newly created website inside a file called <code class=\"language-text\">web.config</code>, So this means that what we created in the UI is generated into this XML file. If we open up the file, we can see the following configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>system.webServer</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rewrite</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rules</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rule</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>React Routes<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stopProcessing</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">url</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>.*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>conditions</span> <span class=\"token attr-name\">logicalGrouping</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>MatchAll<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>add</span> <span class=\"token attr-name\">input</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{REQUEST_FILENAME}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">matchType</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>IsFile<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">negate</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>add</span> <span class=\"token attr-name\">input</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{REQUEST_FILENAME}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">matchType</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>IsDirectory<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">negate</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>conditions</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>action</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Rewrite<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">url</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/index.html<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rule</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rules</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rewrite</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>system.webServer</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>The critical part is inside the <code class=\"language-text\">rules</code> tag. The tag name is an arbitrary string you can change it to whatever you want, and then we have a pattern <code class=\"language-text\">.*</code> Which means everything using regular expression syntax, then we have our rules, we are basically saying if the input contains a file name or a directory name at the end of URL, an action occurs in this case the action is redirecting to <code class=\"language-text\">index.html</code>. You might be wondering why I set <code class=\"language-text\">stopProcessing=&quot;true&quot;</code>, by setting this flag to true it will stop the processing of further rules, and the request will be passed to the IIS request pipeline. Now the unknown paths are handed off to the client side router, and the rest is history.</p>"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"2019-04-09-Hosting-react-app-on-iis"}}}