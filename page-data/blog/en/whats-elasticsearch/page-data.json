{"componentChunkName":"component---src-templates-blog-details-js","path":"/blog/en/whats-elasticsearch","result":{"data":{"markdownRemark":{"timeToRead":3,"frontmatter":{"date":"December 5th, 2018","title":"What's Elasticsearch","tags":["Search","Programming Notes"],"slug":"What's-Elasticsearch/"},"html":"<p>Wikipedia:</p>\n<blockquote>\n<p>Elasticsearch is a search engine based on the Lucene library. It provides a distributed, multitenant-capable full-text search engine with an HTTP web interface and schema-free JSON documents. Elasticsearch is developed in Java and is released as open source under the terms of the Apache License. Official clients are available in Java, .NET (C#), PHP, Python, Apache Groovy, Ruby and many other languages.5 According to the DB-Engines ranking, Elasticsearch is the most popular enterprise search engine followed by Apache Solr, also based on Lucene.</p>\n</blockquote>\n<p>Executing SELECT * FROM .... all the time consumes a lot of CPU also it doesn't have index, One solution would be using FTS (Full Text Search) in RDBMS but in NoSQL world If you need a high performance search engine you'd better use Elasticsearch.</p>\n<img class=\"center-image img-res\" src=\"/img/elastic_stack.jpg\" alt=\"Elastic Stack\" />\n<h3>History</h3>\n<ul>\n<li>1999 - Lucene\n<ul>\n<li>It helped all search engines back then index the data that they were adjusting from the internet and provide reasonable ways of retrieving that information based fuzzy matching.</li>\n</ul>\n</li>\n<li>2004 - Compass\n<ul>\n<li>Built on top of Lucene, the same services but in a more scalable manner, idea was to provide a distributed search solution.</li>\n</ul>\n</li>\n<li>2010 - Elasticsearch\n<ul>\n<li>Distributed, RESTful search and analytical engine</li>\n</ul>\n</li>\n</ul>\n<h3>Use cases</h3>\n<ul>\n<li>Security/log analytics</li>\n<li>Marketing = Use this data to find things:\n<ul>\n<li>How people find our website?</li>\n<li>Where they came from?</li>\n<li>What device they are using?</li>\n<li>What part of the world they are coming from?</li>\n</ul>\n</li>\n<li>Search = ES was built with idea of great search engine</li>\n</ul>\n<h3>Concepts</h3>\n<ul>\n<li>Near Real Time (NRT)</li>\n<li>Cluster:\n<ul>\n<li>collection of our nodes</li>\n<li>has a unique name</li>\n</ul>\n</li>\n<li>Node:\n<ul>\n<li>part of the cluster to store the data</li>\n<li>has a unique name</li>\n</ul>\n</li>\n<li>Index:\n<ul>\n<li>a collection of similar documents</li>\n</ul>\n</li>\n<li>Type:\n<ul>\n<li>a category or a partition of your index</li>\n</ul>\n</li>\n<li>Document:\n<ul>\n<li>in JSON format</li>\n<li>customer</li>\n<li>event</li>\n</ul>\n</li>\n</ul>\n<h3>Querying</h3>\n<ul>\n<li>Simple query:\n<ul>\n<li>get all accounts: GET bank/account/_search</li>\n<li>get all accounts in state of CA:</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`GET bank/account/_search\n{\n    &quot;query&quot;: {\n        &quot;match&quot;: {\n            &quot;state&quot;: &quot;CA&quot;\n        }\n    }\n}`, ``)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token constant\">GET</span> bank<span class=\"token operator\">/</span>account<span class=\"token operator\">/</span>_search\n<span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string-property property\">\"state\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CA\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n-Â multiple conditions:\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`GET bank/account/_search\n{\n    &quot;query&quot;: {\n        &quot;bool&quot;: {\n            &quot;state&quot;: &quot;CA&quot;\n        }\n    }\n}`, ``)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token constant\">GET</span> bank<span class=\"token operator\">/</span>account<span class=\"token operator\">/</span>_search\n<span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"bool\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string-property property\">\"state\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CA\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li>boost: 3 = three times more important than state</li>\n<li><code class=\"language-text\">_score</code>: How ES identifies the relevance of a document based on your search query</li>\n</ul>\n</li>\n</ul>\n<h3>Bulk loading data into Elasticsearch</h3>\n<p>_bulk: The endpoint for bulk api, this is where we send request to when we want to bulk load data. it expects new-line delimited JSON data (including a new-line at the very end, which is important, otherwise we'll get errors). It allows us to <code class=\"language-text\">Index</code>, <code class=\"language-text\">Create</code>, <code class=\"language-text\">Delete</code>, <code class=\"language-text\">Update</code>. When using this we need to make sure we are using <code class=\"language-text\">--data-binary</code> flag from the curl command.</p>\n<ul>\n<li>/_bulk</li>\n<li>new-line JSON</li>\n<li>Index, Create, Delete, Update</li>\n<li>--data-binary</li>\n</ul>\n<h4>How to bulk load data</h4>\n<ul>\n<li>Create a file that has some data in it:</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`{ &quot;index&quot; : { &quot;_index&quot; : &quot;indexName&quot;, &quot;_type&quot; : &quot;typeName&quot;, &quot;_id&quot;: &quot;1&quot; }}\n{&quot;title&quot;:&quot;Web Developer II&quot;,&quot;author&quot;:&quot;Chrysler Clerk&quot;,&quot;content&quot;:&quot;Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Proin risus. Praesent lectus.&quot;,&quot;publishedDate&quot;:&quot;2018-02-03T17:51:14Z&quot;}`, ``)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">{</span> <span class=\"token string-property property\">\"index\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">\"_index\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"indexName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string-property property\">\"_type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"typeName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string-property property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token string-property property\">\"title\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Web Developer II\"</span><span class=\"token punctuation\">,</span><span class=\"token string-property property\">\"author\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Chrysler Clerk\"</span><span class=\"token punctuation\">,</span><span class=\"token string-property property\">\"content\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Proin risus. Praesent lectus.\"</span><span class=\"token punctuation\">,</span><span class=\"token string-property property\">\"publishedDate\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"2018-02-03T17:51:14Z\"</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<ul>\n<li>Load the data into Elasticsearch using curl:</li>\n</ul>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`curl -s -H &quot;Content-Type: application/x-ndjson&quot; -XPOST localhost:9200/_bulk --data-binary &quot;@reqs&quot;; echo`, ``)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">curl <span class=\"token operator\">-</span>s <span class=\"token operator\">-</span><span class=\"token constant\">H</span> <span class=\"token string\">\"Content-Type: application/x-ndjson\"</span> <span class=\"token operator\">-</span><span class=\"token constant\">XPOST</span> <span class=\"token literal-property property\">localhost</span><span class=\"token operator\">:</span><span class=\"token number\">9200</span><span class=\"token operator\">/</span>_bulk <span class=\"token operator\">--</span>data<span class=\"token operator\">-</span>binary <span class=\"token string\">\"@reqs\"</span><span class=\"token punctuation\">;</span> echo</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>"}},"pageContext":{"slug":"What's-Elasticsearch/"}},"staticQueryHashes":[]}